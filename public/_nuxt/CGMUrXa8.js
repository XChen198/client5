import{E}from"./ne-LEtTm.js";import{E as b}from"./B1sV65LB.js";import{E as V,a as v}from"./CNSLevp2.js";import{E as F}from"./NkgphkwY.js";import{E as u}from"./BrhpWW4a.js";import{f as h,g as N,r as B,J as w,c as U,b as o,w as s,a as k,j as t,N as C,o as I,d as i}from"./Dh4ENSPc.js";import{u as M}from"./FKMdIz4G.js";import"./CoS429Et.js";import"./BGpyNCB4.js";import"./iEayIuJa.js";import"./r5W6hzzQ.js";const R={class:"myinfo",style:{"margin-top":"20px"}},K=h({__name:"info",setup(S){const c=N(),_=M(),p=B(),a=w({oldPassword:"",newPassword:""}),f=(n,e,r)=>{e===""?r(new Error("密码不能为空")):e.length<6?r(new Error("密码长度不能小于6位")):r()},g=w({oldPassword:[{required:!0,message:"请输入旧密码",trigger:"blur"},{validator:f,trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{validator:f,trigger:"blur"}]}),y=n=>{n&&n.validate(async e=>{if(e)try{const r=await $fetch("https://nyknow.com/api/user",{method:"PUT",credentials:"include",body:JSON.stringify({oldPassword:a.oldPassword,newPassword:a.newPassword})});r.code===0?(u.success(r.message),c.push("/login")):u.error(r.message)}catch{u.error("修改失败,请稍后再试")}})};return(n,e)=>{const r=E,m=b,d=v,P=F,x=V;return I(),U(C,null,[o(r,{class:"mx-1",type:"info"},{default:s(()=>[i("我的信息")]),_:1}),k("div",R,[o(x,{ref_key:"ruleFormRef",ref:p,model:t(a),rules:t(g),style:{"max-width":"600px",margin:"0 auto"}},{default:s(()=>[o(d,{label:"用户名 :"},{default:s(()=>{var l;return[o(m,{value:(l=t(_).userInfo)==null?void 0:l.username,disabled:"",style:{"max-width":"600px",margin:"0 auto"}},null,8,["value"])]}),_:1}),o(d,{label:"旧密码 :",prop:"oldPassword"},{default:s(()=>[o(m,{modelValue:t(a).oldPassword,"onUpdate:modelValue":e[0]||(e[0]=l=>t(a).oldPassword=l),modelModifiers:{trim:!0},type:"password"},null,8,["modelValue"])]),_:1}),o(d,{label:"新密码 :",prop:"newPassword"},{default:s(()=>[o(m,{modelValue:t(a).newPassword,"onUpdate:modelValue":e[1]||(e[1]=l=>t(a).newPassword=l),modelModifiers:{trim:!0},type:"password"},null,8,["modelValue"])]),_:1}),o(d,null,{default:s(()=>[o(P,{type:"primary",onClick:e[2]||(e[2]=l=>y(t(p))),style:{width:"100%"}},{default:s(()=>[i("重置密码")]),_:1})]),_:1})]),_:1},8,["model","rules"])]),o(r,{class:"mx-1",type:"warning",style:{margin:"0 auto"}},{default:s(()=>[i("修改成功后需重新登录")]),_:1})],64)}}});export{K as default};
