import{E as le,_ as N}from"./CZiLuAN9.js";import{E as oe}from"./ne-LEtTm.js";import{a as ne,E as re}from"./COhxEt85.js";import{a as ie,E as de}from"./CeaJMaa7.js";import{E as ce}from"./B1sV65LB.js";import{E as ue}from"./NkgphkwY.js";import{E as pe}from"./AEnOYdjy.js";import{_ as me}from"./BDtMiokZ.js";import{E as u}from"./BrhpWW4a.js";import"./BP04w6uM.js";import"./vQi6h-p6.js";import{u as _e,a as ye}from"./Xu3fRhgo.js";import{f as ve,a9 as fe,g as ge,r as _,a1 as F,c as v,a as l,b as e,w as a,j as y,t as i,N as U,O as G,i as E,k as V,o as c,d as r,a2 as he,p as xe,e as we}from"./Dh4ENSPc.js";import{u as ke}from"./FKMdIz4G.js";import{_ as Ee}from"./DlAUqK2U.js";import"./CoS429Et.js";import"./BGpyNCB4.js";import"./r5W6hzzQ.js";import"./B_pKZ7vX.js";const x=T=>(xe("data-v-5c93bce3"),T=T(),we(),T),$e={class:"back"},Ce={xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024","data-v-ea893728":"",style:{width:"24px","vertical-align":"text-top"}},Ve=x(()=>l("path",{fill:"currentColor",d:"M224 480h640a32 32 0 1 1 0 64H224a32 32 0 0 1 0-64"},null,-1)),Te=x(()=>l("path",{fill:"currentColor",d:"m237.248 512 265.408 265.344a32 32 0 0 1-45.312 45.312l-288-288a32 32 0 0 1 0-45.312l288-288a32 32 0 1 1 45.312 45.312z"},null,-1)),ze=[Ve,Te],Ie=x(()=>l("span",{style:{"margin-left":"5px"}},"返回",-1)),be={class:"post"},Ae=x(()=>l("img",{src:N},null,-1)),Se={class:"username"},Pe={class:"main"},Me=["innerHTML"],Ue={class:"footer"},Ne={class:"comments"},Oe=x(()=>l("img",{src:N},null,-1)),Be={style:{"margin-left":"8px"}},Re={class:"content"},Ge={style:{margin:"0 auto"},class:"timeAndReply"},De={key:0},je={class:"sendComment",style:{"text-align":"center"}},He=x(()=>l("img",{src:N},null,-1)),Je={style:{width:"80%",margin:"10px auto"}},Le=x(()=>l("img",{src:N},null,-1)),Fe={style:{width:"80%",margin:"10px auto"}},We={key:0},Ye={style:{"margin-top":"10px"}},qe=ve({__name:"[id]",async setup(T){let f,z;const{params:I}=fe(),W=ke(),Y=ge(),O=_(1),w=_(1);_(0);const b=_(""),g=_(""),$=_(""),D=_(""),j=_(""),p=_({total:0,comments:[],parent:{_id:"",content:"",avatar:"",createdAt:"",updatedAt:"",username:""}}),A=_(!1),B=_("50%"),C=_(!1),{data:h}=([f,z]=F(()=>_e(`http://nyknow.com/api/post/${I.id}`,{method:"GET",credentials:"include"},"$ha8dIhfv4Y")),f=await f,z(),f),{data:R}=([f,z]=F(()=>ye("comments",()=>$fetch(`http://nyknow.com/api/comment/get?postId=${I.id}&currentPage=${O.value}`,{method:"GET",credentials:"include"}),{watch:[O,C]})),f=await f,z(),f),q=o=>{g.value="",D.value=o},K=o=>{$.value="",j.value=o},Q=async(o,s)=>{window.innerWidth<768?B.value="100%":B.value="50%";try{const d=await $fetch(`https://nyknow.com/api/comment/child?parentId=${o}&currentPage=${w.value}`,{method:"GET",credentials:"include"});d.code===0?(p.value=d.data,A.value=s):u.error(d.message)}catch{u.error("网络错误")}},H=async o=>{try{const s=await $fetch("https://nyknow.com/api/user",{method:"GET",credentials:"include"});s.code===0?W.setUserInfo(s.data):(u.error("评论前请先登录"),Y.push("/login"));const d=await $fetch("https://nyknow.com/api/comment/reply",{method:"POST",credentials:"include",body:JSON.stringify({parentId:o,postId:I.id,content:g.value})});d.code===0?(u.success(d.message),g.value="",C.value=!C.value,A.value=!1):u.error(d.message)}catch{u.error("网络错误")}},X=async(o,s,d)=>{try{const n=await $fetch("https://nyknow.com/api/comment/reply",{method:"POST",credentials:"include",body:JSON.stringify({parentId:o,postId:s,content:$.value,replyId:d})});n.code===0?(u.success(n.message),$.value="",w.value=Math.ceil(p.value.total/10),J(w.value)):u.error(n.message)}catch{u.error("网络错误")}},Z=o=>{O.value=o},J=async o=>{w.value=o;try{const s=await $fetch(`https://nyknow.com/api/comment/child?parentId=${p.value.parent._id}&currentPage=${w.value}`,{method:"GET",credentials:"include"});s.code===0?p.value=s.data:u.error(s.message)}catch{u.error("网络错误")}},ee=async()=>{try{const o=await $fetch("https://nyknow.com/api/comment/create",{method:"POST",credentials:"include",body:JSON.stringify({postId:I.id,content:b.value})});o.code===0?(b.value="",u.success(o.message),C.value=!C.value):u.error(o.message)}catch{u.error("网络错误")}};return(o,s)=>{const d=le,n=oe,S=ne,k=ie,te=de,P=ce,M=ue,L=pe,ae=re,se=me;return c(),v(U,null,[l("div",$e,[l("div",{class:"backbtn",onClick:s[0]||(s[0]=t=>o.$router.back())},[(c(),v("svg",Ce,ze)),Ie])]),l("div",be,[e(d,{size:50,src:y(h).data.avatar,style:{"vertical-align":"middle"}},{default:a(()=>[Ae]),_:1},8,["src"]),l("span",Se,i(y(h).data.username),1),l("div",Pe,[l("h3",null,i(y(h).data.title),1),l("div",{innerHTML:y(h).data.content},null,8,Me)]),l("div",Ue,[l("span",null,i(y(h).data.createdAt.split("T")[0]),1)])]),l("div",Ne,[e(n,{class:"mx-1"},{default:a(()=>[r("浏览量: "+i(y(h).data.visitors),1)]),_:1}),e(n,{class:"mx-1",style:{"margin-left":"8px"}},{default:a(()=>[r("评论数: "+i(y(h).data.comments),1)]),_:1}),(c(!0),v(U,null,G(y(R).data.comments,t=>(c(),v("div",{class:"comment",key:t._id},[e(d,{size:45,src:t.avatar,style:{"vertical-align":"middle"}},{default:a(()=>[Oe]),_:2},1032,["src"]),l("span",Be,i(t.username),1),l("div",Re,[e(n,{class:"mx-1",size:"large"},{default:a(()=>[r(i(t.content),1)]),_:2},1024),e(S),t.total!==0?(c(),E(te,{key:0},{default:a(()=>[(c(!0),v(U,null,G(t.childComments,m=>(c(),E(k,{style:{"margin-bottom":"8px"},key:m._id},{default:a(()=>[e(n,{class:"mx-1"},{default:a(()=>[r(i(m.username)+": "+i(m.content),1)]),_:2},1024)]),_:2},1024))),128)),t.total>2?(c(),E(k,{key:0},{default:a(()=>[e(n,{class:"mx-1 checkTotal",onClick:m=>Q(t._id,!0)},{default:a(()=>[r("查看全部"+i(t.total)+"条评论",1)]),_:2},1032,["onClick"])]),_:2},1024)):V("",!0)]),_:2},1024)):V("",!0)]),l("div",Ge,[e(n,{class:"mx-1",size:"small"},{default:a(()=>[r(i(t.createdAt.split("T")[0]),1)]),_:2},1024),e(n,{class:"mx-1 reply",style:{"margin-left":"10px"},onClick:m=>q(t._id)},{default:a(()=>[r("回复")]),_:2},1032,["onClick"])]),e(he,{name:"el-fade-in-linear"},{default:a(()=>[D.value===t._id?(c(),v("div",De,[e(P,{modelValue:g.value,"onUpdate:modelValue":s[1]||(s[1]=m=>g.value=m),modelModifiers:{trim:!0},placeholder:"请输入要回复的内容",type:"textarea",style:{width:"100%"},rows:2},null,8,["modelValue"]),e(M,{type:"primary",style:{width:"100%","margin-top":"10px"},onClick:m=>H(t._id)},{default:a(()=>[r("回复")]),_:2},1032,["onClick"])])):V("",!0)]),_:2},1024),e(S)]))),128)),y(R).data.total!==0?(c(),E(L,{key:0,background:"",layout:"prev, pager, next",total:y(R).data.total,"page-size":10,"pager-count":5,style:{"justify-content":"center"},onCurrentChange:Z},null,8,["total"])):V("",!0)]),l("div",je,[e(P,{modelValue:b.value,"onUpdate:modelValue":s[2]||(s[2]=t=>b.value=t),modelModifiers:{trim:!0},placeholder:"请输入评论内容",type:"textarea",style:{width:"100%"},rows:6},null,8,["modelValue"]),e(M,{type:"primary",size:"large",onClick:ee,style:{width:"100%","margin-top":"10px"}},{default:a(()=>[r("发送")]),_:1})]),e(se,null,{default:a(()=>[e(ae,{modelValue:A.value,"onUpdate:modelValue":s[6]||(s[6]=t=>A.value=t),size:B.value},{default:a(()=>[l("div",null,[e(d,{size:45,src:p.value.parent.avatar,style:{"vertical-align":"middle"}},{default:a(()=>[He]),_:1},8,["src"]),e(n,{class:"mx-1",style:{"margin-left":"8px"}},{default:a(()=>[r(i(p.value.parent.username),1)]),_:1}),l("div",Je,[e(k,null,{default:a(()=>[e(n,{class:"mx-1",size:"large"},{default:a(()=>[r(i(p.value.parent.content),1)]),_:1})]),_:1}),e(k,{style:{"margin-top":"10px","text-align":"right"}},{default:a(()=>[e(n,{class:"mx-1",size:"small",style:{"margin-top":"8px"}},{default:a(()=>[r(i(p.value.parent.createdAt.split("T")[0]),1)]),_:1})]),_:1})]),e(S,null,{default:a(()=>[r("以下是回复的评论")]),_:1})]),(c(!0),v(U,null,G(p.value.comments,t=>(c(),v("div",{key:t._id,style:{"margin-top":"10px"}},[e(d,{size:45,src:t.avatar,style:{"vertical-align":"middle"}},{default:a(()=>[Le]),_:2},1032,["src"]),e(n,{class:"mx-1",style:{"margin-left":"8px"}},{default:a(()=>[r(i(t.username)+": ",1)]),_:2},1024),l("div",Fe,[e(k,null,{default:a(()=>[t.replyUsername?(c(),E(n,{key:0},{default:a(()=>[r("回复 "+i(t.replyUsername)+" : "+i(t.content),1)]),_:2},1024)):(c(),E(n,{key:1,class:"mx-1",size:"large"},{default:a(()=>[r(i(t.content),1)]),_:2},1024))]),_:2},1024),e(k,{style:{"margin-top":"10px","text-align":"right"}},{default:a(()=>[e(n,{class:"mx-1",size:"small"},{default:a(()=>[r(i(t.createdAt.split("T")[0]),1)]),_:2},1024),e(n,{class:"mx-1 reply",style:{"margin-left":"10px"},onClick:m=>K(t._id)},{default:a(()=>[r("回复")]),_:2},1032,["onClick"])]),_:2},1024),j.value===t._id?(c(),v("div",We,[e(P,{modelValue:$.value,"onUpdate:modelValue":s[3]||(s[3]=m=>$.value=m),modelModifiers:{trim:!0},placeholder:"请输入要回复的内容",type:"textarea",style:{width:"100%"},rows:2},null,8,["modelValue"]),e(M,{type:"primary",style:{width:"100%","margin-top":"10px"},onClick:m=>X(t.parentId,t.postId,t._id)},{default:a(()=>[r("回复")]),_:2},1032,["onClick"])])):V("",!0)]),e(S)]))),128)),e(L,{background:"",layout:"prev, pager, next",total:p.value.total,"page-size":10,"pager-count":5,style:{"justify-content":"center"},"current-page":w.value,onCurrentChange:J},null,8,["total","current-page"]),l("div",Ye,[e(P,{modelValue:g.value,"onUpdate:modelValue":s[4]||(s[4]=t=>g.value=t),modelModifiers:{trim:!0},placeholder:`回复 ${p.value.parent.username}`,type:"textarea",style:{width:"100%"},rows:2},null,8,["modelValue","placeholder"]),e(M,{type:"primary",style:{width:"100%","margin-top":"10px"},onClick:s[5]||(s[5]=t=>H(p.value.parent._id))},{default:a(()=>[r("回复")]),_:1})])]),_:1},8,["modelValue","size"])]),_:1})],64)}}}),yt=Ee(qe,[["__scopeId","data-v-5c93bce3"]]);export{yt as default};
