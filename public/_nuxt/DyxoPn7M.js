import{E as W}from"./ne-LEtTm.js";import{E as X}from"./CZX_mret.js";import{_ as Y}from"./BQU9x2pH.js";import{a as Z,E as ee}from"./CeaJMaa7.js";import{E as te}from"./D_Fmugrb.js";import{E as le,a as oe}from"./COhxEt85.js";import{E as ae}from"./2NZr4Mmw.js";import{E as ne}from"./AEnOYdjy.js";import{a as se,E as re}from"./BP04w6uM.js";import{E as ce}from"./B1sV65LB.js";import{_ as ie}from"./BDtMiokZ.js";import{E as ue}from"./NkgphkwY.js";import{E as s}from"./BrhpWW4a.js";import"./vQi6h-p6.js";import{Q as de}from"./Cc0l5TVS.js";import{f as pe,r,h as me,c as w,b as o,w as a,i as x,k as I,a as E,N as C,O as P,o as i,d as c,t as S,j as _e,p as fe,e as ve}from"./Dh4ENSPc.js";import{_ as ge}from"./DlAUqK2U.js";import"./CoS429Et.js";import"./B_pKZ7vX.js";import"./BGpyNCB4.js";import"./r5W6hzzQ.js";const O=v=>(fe("data-v-552c4dc0"),v=v(),ve(),v),ye=O(()=>E("h5",null,"选择分类：",-1)),he=O(()=>E("h5",null,"标题：",-1)),Ee=pe({__name:"published",setup(v){const g=r(1),b=r([]),u=r(0),d=r(),y=r(!1),p=r(""),m=r(""),_=r(""),$=r("");me(async()=>{try{const l=await $fetch("https://nyknow.com/api/post/user",{method:"GET",credentials:"include"});l.code===0&&(b.value=l.data.result,u.value=l.data.total)}catch{}});const q=[{value:"招聘",label:"招聘"},{value:"求职",label:"求职"},{value:"出租",label:"出租"},{value:"新闻",label:"新闻"},{value:"活动",label:"活动"},{value:"生活",label:"生活"},{value:"科技",label:"科技"},{value:"娱乐",label:"娱乐"},{value:"教育",label:"教育"},{value:"社会",label:"社会"},{value:"编程",label:"编程"},{value:"其他",label:"其他"}],B={theme:"snow",placeholder:"请输入内容",modules:{toolbar:{container:[["bold","italic","underline","strike"],["blockquote","code-block"],["link","image"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]],handlers:{image:function(){var l;(l=document.getElementById("getFile"))==null||l.click()}}}}},D=async l=>{try{const e=l.target.files[0],n=new FormData;n.append("img",e);const f=await $fetch("https://nyknow.com/api/post/upload",{method:"POST",credentials:"include",body:n});if(f.code===0){const h=document.querySelector(".ql-editor");h&&(h.innerHTML+=`<img src="${f.data}" alt="contentImg" style="max-width: 100%; max-height: 400px;">`)}else s.error(f.message)}catch{}},N=async l=>{try{const e=await $fetch(`https://nyknow.com/api/post/${l}`,{method:"PUT",credentials:"include",body:JSON.stringify({type:p.value,title:m.value,content:_.value})});if(e.code===0){s.success(e.message),p.value="",m.value="",_.value="";const n=document.querySelector(".ql-editor");n&&(n.innerHTML=""),y.value=!1}else s.error(e.message)}catch{s.error("网络错误")}},V=async l=>{try{g.value=l;const e=await $fetch(`https://nyknow.com/api/post/user?currentPage=${g.value}`,{method:"GET",credentials:"include"});e.code===0&&(b.value=e.data.result,u.value=e.data.total)}catch{}},z=async l=>{try{const e=await $fetch(`https://nyknow.com/api/post/${l}`,{method:"GET",credentials:"include"});e.code===0?(d.value=e.data,p.value=d.value.type,m.value=d.value.title,_.value=d.value.content,$.value=d.value._id,y.value=!0):s.error(e.message)}catch{s.error("网络错误")}},L=async l=>{try{const e=await $fetch(`https://nyknow.com/api/post/${l}`,{method:"DELETE",credentials:"include"});e.code===0?(s.success(e.message),V(g.value)):s.error(e.message)}catch{s.error("网络错误")}};return(l,e)=>{const n=W,f=X,h=Y,k=Z,T=te,M=oe,U=ee,F=ae,j=ne,G=se,H=re,Q=ce,A=ie,J=ue,R=le;return i(),w(C,null,[o(n,{class:"mx-1",type:"info"},{default:a(()=>[c("查看已经发布的帖子")]),_:1}),u.value===0?(i(),x(f,{key:0,description:"还没有上传任何帖子"})):I("",!0),E("div",null,[(i(!0),w(C,null,P(b.value,t=>(i(),x(F,{key:t._id,class:"mb-2"},{default:a(()=>[o(U,null,{default:a(()=>[o(k,{span:9},{default:a(()=>[o(h,{to:`/post/${t._id}`,class:"goPost"},{default:a(()=>[c(S(t.title),1)]),_:2},1032,["to"])]),_:2},1024),o(k,{span:9},{default:a(()=>[o(n,null,{default:a(()=>[c(S(t.updatedAt.split("T")[0]),1)]),_:2},1024)]),_:2},1024),o(k,{span:6,class:"text-right"},{default:a(()=>[o(T,{underline:!1,onClick:K=>z(t._id)},{default:a(()=>[c("编辑")]),_:2},1032,["onClick"]),o(M,{direction:"vertical"}),o(T,{underline:!1,onClick:K=>L(t._id)},{default:a(()=>[c("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),u.value>0?(i(),x(j,{key:0,onCurrentChange:V,"current-page":g.value,"page-size":10,total:u.value,layout:"prev, pager, next"},null,8,["current-page","total"])):I("",!0),o(R,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=t=>y.value=t),title:"编辑页面",size:"70%"},{default:a(()=>[ye,o(H,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),placeholder:"选择",style:{width:"100%"},size:"large"},{default:a(()=>[(i(),w(C,null,P(q,t=>o(G,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),he,o(Q,{modelValue:m.value,"onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t),style:{width:"100%",height:"40px","margin-bottom":"20px"},placeholder:"标题推荐在30字以内"},null,8,["modelValue"]),o(n,{class:"mx-1",type:"danger"},{default:a(()=>[c("注意: 单张图片不能高于2MB!")]),_:1}),o(A,null,{default:a(()=>[o(_e(de),{options:B,content:_.value,"onUpdate:content":e[2]||(e[2]=t=>_.value=t),"content-type":"html"},null,8,["content"]),E("input",{type:"file",style:{display:"none"},id:"getFile",onChange:e[3]||(e[3]=t=>D(t)),accept:"image/gif,image/jpeg,image/jpg,image/png"},null,32)]),_:1}),o(J,{type:"primary",size:"large",style:{"margin-top":"20px",width:"100%"},onClick:e[4]||(e[4]=t=>N($.value))},{default:a(()=>[c("更新")]),_:1})]),_:1},8,["modelValue"])])],64)}}}),Ge=ge(Ee,[["__scopeId","data-v-552c4dc0"]]);export{Ge as default};
